# Steps for publishing project cache

steps:
  - bash: 'mkdir -p $(Build.StagingDirectory)'
    condition: succeeded()
    displayName: '[Cache][Publish] Create cache directory'

  - bash: 'cd $(ESY__CACHE_INSTALL_PATH) && tar -czf $(Build.StagingDirectory)/esy-cache.tar.gz .'
    workingDirectory: ''
    condition: succeeded()
    displayName: '[Cache][Publish] Tar esy cache directory'

  - task: PublishBuildArtifacts@1
    displayName: '[Cache][Publish] Upload tarball'
    condition: succeeded()
    inputs:
        pathToPublish: '$(Build.StagingDirectory)'
        artifactName: 'cache-$(Agent.OS)-install'
        parallel: true
        parallelCount: 8
